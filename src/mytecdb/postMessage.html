<html><head>
  
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="keywords" content="database,mysql,linux,percona,数据库" />
  <meta name="description" content="database,mysql,linux,percona" />

<title>leave message-mytecdb</title>

<link rel="stylesheet" type="text/css" href="css/style.css">

</head>

<body>

<!--顶部导航-->
<div class="page-title-fixed">
	<div class="container">
		<h1 class="logo">
			<a href="index.php">
				<span class="logo-name">mytecdb.com</span>
			</a>
		</h1>
		<ul class="page-menus">
			<li>
				<a href="index.php">最新文章</a>
			</li>
			<li>
				<a href="javascript:;">MySQL</a>
			</li>
			<li>
				<a href="javascript:;">PostgreSQL</a>
			</li>
			<li>
				<a href="javascript:;">Oracle</a>
			</li>
			<li>
				<a href="javascript:;">Linux</a>
			</li>
			<li>
				<a href="postMessage.html" class="active">Message</a>
			</li>
		</ul>
	</div>
</div>
<!--内容-->
<div class="wrapper">
	<div class="container">
		<div class="sidebar-wrapper fixed">
			<div class="sidebar" style="height: 428px;">
				<ul class="menu-group">
					<li class="menu-item menu-item-1 active">
						<a class=" sub-title" href="javascript:;">MySQL</a>
						<ul>
							<li class="menu-item menu-item-2">
								<a href="index.php?type=4">MySQL安装</a>
							</li>
							<li class="menu-item menu-item-2">
								<a href="index.php?type=7">MySQL升级</a>
							</li>
							<li class="menu-item menu-item-2">
								<a href="index.php?type=9">MySQL优化</a>
							</li>
							<li class="menu-item menu-item-2">
								<a href="index.php?type=10">MySQL死锁</a>
							</li>
							<li class="menu-item menu-item-2">
								<a href="index.php?type=5">MySQL相关工具</a>
							</li>
							<li class="menu-item menu-item-2">
								<a href="index.php?type=6">MySQL Bug</a>
							</li>
						</ul>
					</li>
				</ul>
			</div>
		</div>

		<div class="main-container">

		<div class="markdown">

        
		  <div id="blog_content" class="blog_content">
		    <div >
		    	<label>昵称：</label><input id="user" type="" name="">
		    </div>
		    <div>
		    	<label>邮箱：</label><input id="email" type="" name="">
		    </div>
		    <div>
		    	<label>留言：</label><textarea id="message" style="width: 80%;height: 100px;" placeholder="写下你的留言..."></textarea>
		    	<button id="btnMessageCommit" style="width: 80px;height: 30px;" type="button">提交</button>
		  	</div>
		  </div>

		  <br>
		  <hr>
		  <div id="message_container">
		  </div>

		  
		</div>

			
		</div>
		</div>
	</div>
	
	<!--图片弹窗-->
	<div class="imgtc" style="display: none;">
		<img src="">
	</div>
	
</div>

<script src="js/jquery-1.11.0.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
	$(function() {
		//左侧菜单
		var h = 0;
		$('.menu-item-1 .sub-title').click(function() {
			$(this).parent().toggleClass('active collapse');
			$('.menu-item-1').each(function() {
				h += $(this).height();
			})
			//给菜单赋值高度
			$('.sidebar').css({
				"height": h
			});
			h = 0;
		})
		//右上角鼠标悬浮触发下拉
		$('.dropdown-toc').hover(function() {
			$('.dropdown-body').toggle();
		})
		//滚动监听
		var leg = $('.maodian').length;
		$(window).scroll(function() {
			$('.imgtc').hide(); //滚动后图片放大隐藏
			var sh = $(window).scrollTop()
			//右上悬浮
			sh > 86 ? $('.anchor-toc').addClass('fixed') : $('.anchor-toc').removeClass('fixed');
			//循环遍历锚点
			for(i = 1; i <= leg; i++) {
				if($("#mao" + i).offset().top-140 <= sh) {
					$('.maodian').removeClass('active');
					$('#mao' + i).addClass("active");
					$('.toc-current').text($('#mao'+i).parent().text());
					$('.dropdown-body ul li').removeClass('active').eq(i-1).addClass('active');
				}
				
			}
			sh < 140?$('.toc-current').text("本页导航"):"";
		})
		//右上角点击
		$('.dropdown-body ul li').click(function(){
			var jt = $(this).index();
			$(window).scrollTop($('.maodian').eq(jt).offset().top-140);
		})
		//图片放大
		$('img').click(function(){
			var img = $(this).attr('src');
			$('.imgtc').show().find('img').attr('src',img);
		})
		$('.imgtc').click(function(){
			$(this).toggle();
		})

		//提交留言
		$("#btnMessageCommit").click(function(){
		  var user = $("#user").val();
		  var email = $("#email").val();
		  var message = $("#message").val();
		  
		  //下面转义特殊字符
		  user = $('<div/>').text(user).html();
		  email = $('<div/>').text(email).html();
		  message = $('<div/>').text(message).html();

		  data = {"user":user,"email":email,"message":message}

		  if (user == "" || email== "" || message == ""){
		  	alert("昵称、邮箱和留言不能为空！");
		  }else{
		  	$.post("http://mytecdb.com/api/postMessage.php",data,function(result,status){
		  		if(status != "success"){
		  			alert("调用失败！");
		  		}else{
		  			if (result.code == 0){
		  				alert("留言成功！");
					    window.location.reload();
		  			}
		  			else{
		  				alert(result.message);
		  			}
		  		}   
			});
		  }
		});
	})

	//加载留言
	$.get("http://mytecdb.com/api/getMessage.php",function(result,status){
  		if(status != "success"){
  			alert("调用失败！")
  		}else{

  			for(let i=0;i<result.length;i++){
  				var addHtml = '<div class="blog_main"><div class="blog_title"><h3><a style="pointer-events: none;">'+result[i].user+'</a></h3><label style="font-size:12px;">'+result[i].ts+'</label></div><div class="blog_content">'+result[i].message+'</div></div>';
        		$("#message_container").append(addHtml);
    		}

    		if (result.length <= 0){
    			$("#message_container").append("<p>当前没有留言~</p>");
    		}
  		}
	});


</script>



</body></html>